# Project DND Tower: 游戏开发手册 (Game Design Document)

**版本:** 2.0 (商业提案版)
**引擎:** Unity 6
**语言:** C#
**目标平台:** Steam (PC/Mac) -> Console Port
**核心标语:** "用 DND 的规则构建英雄，用魔塔的逻辑掌控命运。"

---

## 1. 游戏概述 (Game Overview)


### 1.1 核心概念 (High Concept)

Project DND Tower 是一款融合了 **Dungeons & Dragons (DND) 5E** 规则深度与 **魔塔 (Magic Tower)** 策略严谨性的 **Roguelike RPG**。
与传统 Roguelike 强调“随机应变”不同，本游戏的核心体验在于 **“信息博弈”与“风险管理”**。玩家需要利用有限的资源（HP、法术位、道具），在战争迷雾笼罩的地牢中，通过“一击脱离”的战术和“属性即钥匙”的解谜思维，将不可控的随机性坍缩为确定的胜利。

### 1.2 核心循环 (Core Loop)
1.  **侦查 (Scout):** 探索迷雾，收集情报 (怪物位置、地形、陷阱)。
2.  **规划 (Plan):** 根据情报决定路线。是正面硬刚，还是绕路，还是用道具破墙？
3.  **交战 (Engage/Hit & Run):** 利用半即时战斗系统进行拉扯，最小化战损。
4.  **构建 (Build):** 利用战利品调整属性和装备，应对下一层的机制锁。


---

## 2. 详细战斗系统 (Combat System)

战斗不仅仅是数值的比拼，更是一场关于“止损”的赌博。

### 2.1 基础规则：半即时制 (ATB)
*   **时间流速:** 战斗并非回合锁定。一旦接触敌人，战斗自动开始。
    *   **心跳节奏:** 约 **0.8秒** 为一个攻击回合。
    *   **流程:** 玩家判定 -> 怪物判定 -> 结算扣血 -> 0.8秒冷却 -> 下一回合。
*   **交互逻辑:** 玩家处于被动观察状态，但随时手握“紧急制动权”。

### 2.2 核心机制：一击脱离 (Hit & Run)
玩家可以随时按下 **空格键 (Space)** 试图逃离战斗，但这需要付出代价。
*   **借机攻击 (Opportunity Attack):** 撤退时，怪物会立即发动一次**必定命中**（或高优势）的攻击。
*   **博弈心理:** 
    *   *场景:* 你剩 20HP，怪剩 15HP。下一刀你可能杀它，也可能被暴击打死。（谁先出手很重要）
    *   *决策:* 是赌下一刀的运气，还是吃一下借机攻击（掉 8HP）稳健撤退，去回血后再来？

### 2.3 怪物生态与再生
*   **非完全重置:** 撤退后，怪物血量**保持受损状态**。
*   **呼吸回血 (Regeneration):** 怪物在非战斗状态下会缓慢回血。
    *   *公式:* 玩家移动 `(10 - 玩家敏捷/2)` 步，怪物回复 1 HP。
    *   *策略:* 高敏捷 (DEX) 玩家可以利用超高的移动效率，实现“砍一刀跑半张图”的极致风筝流；低敏捷战士则必须速战速决。


### 2.4 战斗 UI (HUD)
战斗界面应简洁且具有压迫感，位于屏幕下方或中央悬浮。

*   **状态条:** 玩家与怪物的 HP 条对比。
*   **意图预知:** 怪物头顶显示下回合动作图标：
    *   ⚔️ **攻击:** 普通平砍。
    *   💢 **重击:** 下回合双倍伤害（提示玩家该撤退了！）。
    *   🛡️ **防御:** 提升 AC，减少受到的伤害。
*   **撤退读条:** 按住空格键时，显示环形读条 (0.3秒)，防止误触，增加紧张感。

---

## 3. 属性与交互系统 (Attributes & Exploration)


属性不再只是战斗数值，它们是打开地牢不同“门”的七把钥匙。

### 3.1 属性即钥匙 (Stats as Keys)


| 属性 | 战斗维 (Combat) | 探索维 (Interaction) | 典型应用场景 |
| :--- | :--- | :--- | :--- |
| **STR (力量)** | 物理伤害，负重 | **暴力** | 没红钥匙？判定 `STR > 门硬度`，直接砸开门 (扣除少量体力)。 |
| **DEX (敏捷)** | 攻速，闪避借机攻击 | **灵巧** | 走过尖刺陷阱不掉血；无伤开启宝箱；降低敌人回血速度。 |
| **CON (体质)** | HP上限，抗毒 | **生存** | 强行穿过毒气室；通过熔岩地形时伤害减半。 |
| **INT (智力)** | 法术位上限，魔伤 | **知识** | 鉴定怪物弱点 (显示 `???` -> 具体数值)；激活传送法阵。 |

| **WIS (感知)** | 抵抗控制，预判 | **直觉** | 显示暗门高亮；战斗中提前 1 回合看到怪物“暴击预兆”。 |

| **CHA (魅力)** | 召唤增强，商店折扣 | **交涉** | 贿赂守卫让路；安抚愤怒的怪物避免战斗。 |

| **LUK (幸运)** | 暴击率，掉落品质 | **改命** | 影响所有概率判定；重置宝箱掉落池。 |


#### 实践：多维度的“门”与障碍

为了体现属性的工具化，地牢中的障碍应提供非单一的解法：
*   **普通门:** 消耗钥匙（标准解）/ **STR** 暴力破拆（代价：损耗武器耐久，损失生命值）
*   **陷阱门:** 无法用钥匙。**DEX** 判定成功则无伤通过，失败则触发陷阱扣除 HP。

*   **魔法门:** **INT** 判定解析符文开启 / **WIS** 寻找隐藏的魔力节点 / 消耗大量 MP 强行灌注。
*   **铁栅栏:** 无法破拆。**WIS** 寻找隐藏拉杆 / **CHA** 诱导栅栏后的怪物（如小鬼）从内部开启。
*   **etc.**

### 3.2 战争迷雾 (Fog of War)
迷雾是“信息博弈”的核心。

1.  **可见区 (Visible):** 角色视野范围 (如 5格)。可见怪物、物品、动态光影。

2.  **记忆区 (Explored):** 曾经去过但当前无视野。地形保留 (灰色)，但**不可见怪物**。
    *   *风险:* 怪物可能会移动到你的记忆区，当你折返时触发“遭遇战”。
3.  **未知区 (Hidden):** 全黑。
4.  **惊吓机制 (Surprise):** 如果玩家移动进迷雾格并直接撞上怪物，触发“偷袭”：怪物先手攻击，且玩家首回合 AC 减半。


---

## 4. 经济与成长 (Progression)


### 4.1 职业与流派 (Builds)
*   **狂战士 (Berserker):** 主 STR/CON。
    *   *玩法:* "门？那是给弱者开的。" 一路砸过去，血量即货币。
*   **大法师 (Archmage):** 主 INT/WIS。

    *   *玩法:* 资源管理大师。用有限的火球术炸开物理免疫的怪，或者炸开墙壁绕路。
*   **游荡者 (Rogue):** 主 DEX/LUK。
    *   *玩法:* 避战者。利用高敏捷穿过陷阱区，偷取宝箱里的任务道具就跑，根本不打 Boss。
*   **etc. 其他主要职业**


### 4.2 资源管理 (Vancian Magic)
*   **法术位 (Spell Slots):** 摒弃“蓝条”设计。法术按“次数”管理。

    *   *1环 (魔弹):* 3/3 次。
    *   *3环 (火球):* 1/1 次。
*   **策略:** 你只有一颗火球，是用来秒杀 Boss，还是用来炸开那个需要红钥匙的密室？
*   **回复:** 只有稀有的 **篝火 (Campfire)** 才能进行长休，恢复法术位。这迫使玩家规划回程路线。

---


## 5. 装备，法术，药剂，卷轴


在传统魔塔里，如果算出打不过，就只能读档。 在你的游戏里，这些消耗品是用来**打破数学铁律**的。


*   **场景 A：** 面前有个 100 防御的石头人，你攻击力只有 80。怎么打都打不动。
*   **解法 1 (法术)：** 使用 `Melf's Acid Arrow`（马友夫强酸箭），造成每回合 10 点腐蚀伤害（无视防御），持续 5 回合。磨死它。
*   **解法 2 (卷轴)：** 使用 `Scroll of Polymorph`（变形术卷轴），把石头人变成一只 1 防御的绵羊。
*   **解法 3 (药水)：** 喝下 `Potion of Giant Strength`（巨人力量药水），这一层内力量 +50，直接硬刚。

模仿模拟宇宙，要有预制的装备，法术，药剂，卷轴，但是战斗不能纯依靠装备，装备应该没有数值，只有特效。
卷轴就是要功能齐全，甚至可以照搬 DnD 的法术。

药剂可以照搬其他 DnD 游戏里的药剂。

## 5. 地图与生态 (Map Generation)

### 5.1 生成逻辑：锁钥拓扑 (Lock & Key Topology)
我们不随机堆砌房间，而是先生成“逻辑树”，再生成“地图”。
1.  **生成逻辑链:** 起点 -> (锁: 哥布林守卫) -> 中点 -> (钥匙: 力量药水) -> 终点。

2.  **验证机制 (The Solver):** 生成后，系统运行一个虚拟 AI 跑图。
    *   *检测:* AI 拿走所有必经之路的资源，打败所有必经之路的怪，HP 是否 > 0？
    *   *结果:* 如果 > 0，地图合格；否则重生成或动态添加补给站。
3.  **回环与风筝:** 地图包含 15% 的额外连接 (Loops)，确保地图不是单行道，给玩家“绕柱子”风筝怪物的空间。

### 5.2 互动生态
*   **阵营对立:** 怪物之间有阵营。地精攻击兽人，史莱姆腐蚀装备。玩家可以引诱强敌去踩陷阱，或者引怪对打。

---

## 6. 开发规划 (Roadmap)


### 6.1 开发策略：吃自己的狗粮 (Eat Your Own Dog Food)

先做编辑器，再做游戏。
*   **Step 1:** 开发 **Map Editor** (In-Game)。
*   **Step 2:** 开发者使用 Editor 制作前 50 层主线关卡 (Campaign)。
*   **Step 3:** 开放 Editor 给玩家 (Workshop)。

### 6.2 阶段性目标
*   **Phase 1: 最小可玩原型 (The Prototype) [1-2周]**
    *   实现核心战斗：HP扣除、空格撤退、借机攻击逻辑。

    *   实现基础属性交互：STR 破门测试。
    *   *交付物:* 一个只有 1 层，只有 1 种怪和 1 种门的测试包。
*   **Phase 2: 循环与系统 (The Loop) [1个月]**

    *   MST 地图生成算法接入。
    *   战争迷雾视觉效果 (Sprite Mask)。
    *   完善 UI (战斗弹窗、资源面板)。
*   **Phase 3: 内容量产 (Content) [2-3个月]**

    *   50 层战役关卡设计。

    *   3 大职业技能体系。
    *   创意工坊接入。

---

**附录：技术栈推荐**

*   **Core:** Unity 2022+ LTS
*   **Data:** ScriptableObject (严禁 JSON 存静态数据)
*   **Map:** Tilemap + Rule Tiles
*   **Fog:** 2D Lights / Sprite Mask

